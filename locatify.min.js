!function(t){"use strict";function e(e){this.config={},t.extend(this,n),e&&t.extend(this,e)}var o=[],n={api_endpoint:"http://api.locatify.co.uk/v1/address/",api_key:"",input:"#locatify-input",button:"#locatify-button",message:"#locatify-message",dropdown:"#locatify-dropdown",output_fields:{line_1:"#line-1",line_2:"#line-2",line_3:"#line-3",line_4:"#line-4",post_town:"#post-town",postcode:"#postcode"}};e.prototype.setupPlugin=function(t){this.$context=t,this.checkInputFields(),this.setupListeners()},e.prototype.checkInputFields=function(){var e=this,o=e.message.replace("#",""),n=e.dropdown.replace("#","");return t(this.dropdown).length||t("<div/>").insertAfter(e.button).prop("id",n),t(this.message).length||t("<div/>").appendTo(e.$context).prop("id",o),t(this.input).length?t(this.button).length?void 0:(t(this.message).text('The required button "'+this.button+'" does not exist.'),e):(t(this.message).text('The required text input "'+this.input+'" does not exist.'),e)},e.prototype.setupListeners=function(){var e=this,o=e.dropdown+" > select";t(e.input).keypress(function(o){return 13===o.which?(t(e.button).click(),!1):void 0}),t(e.button).on("click",function(){var o=t(e.input).val();e.lookup(o)}),t(e.$context).on("change",o,function(){var o=t(this).find(":selected").data();e.autofill(o),t(e.dropdown).empty()})},e.prototype.lookup=function(e){var o=this,n=o.api_key,i=o.api_endpoint,s="address/",p=i+s,l={api_key:n,postcode:e};t(o.dropdown).empty(),t.ajax({url:p,data:l,crossDomain:!0,dataType:"jsonp",cache:!1,success:function(e){if("success"===e.status){var n="<select><option selected>Please select an address</option></select>";t(n).appendTo(o.dropdown),t.each(e.address,function(e,n){var i='<option value="'+e+'">'+n.address+"</option>",s=t(i);s.data({line_1:n.line_1,line_2:n.line_2,line_3:n.line_3,line_4:n.line_4,post_town:n.town,postcode:n.post_code}),s.appendTo(o.dropdown+" > select")})}else t(o.message).html(e.message)},error:function(e){t(o.dropdown).html(e)}})},e.prototype.autofill=function(e){var o=this;t(o.output_fields.line_1).val(e.line_1),t(o.output_fields.line_2).val(e.line_2),t(o.output_fields.line_3).val(e.line_3),t(o.output_fields.line_4).val(e.line_4),t(o.output_fields.post_town).val(e.post_town),t(o.output_fields.postcode).val(e.postcode)},t.fn.locatify=function(n){var i=this;return 0===i.length?i:(t.each(i,function(i,s){var p=new e(n);o.push(p),p.setupPlugin(t(s))}),i)}}(jQuery);